@use '../abstracts/variables' as *;
@use '../abstracts/mixins' as *;

.reading-independent-page {
  position: relative;
  background-color: $bg-color; // #EAD8B1
  color: #2a2a2a;
  min-height: 100vh;
  padding: 2rem;

  .chapter-nav {
    padding: 2rem;
    .back-link {
      font-family: $font-header;
      text-decoration: none;
      color: $color-muted;
      font-size: 0.9rem;
      transition: $transition-smooth;
      &:hover { color: $accent-color; }
    }
  }

  .handbook-layout {
    max-width: 800px;
    margin: 0 auto;
    background: transparent;
    position: relative;

    // --- ENCABEZADO Y PIE DE PÁGINA DECORATIVOS ---
    .handbook-header, .handbook-footer {
      text-align: center;
      font-family: $font-vintage;
      color: rgba($ink-color, 0.6);
      font-size: 0.8rem;
      margin: 2rem 0;

      .decorative-line, .decorative-line-bottom {
        display: flex;
        align-items: center;
        &::before, &::after {
          content: '————— ☙ —————';
          flex: 1;
          letter-spacing: -2px;
        }
        span { padding: 0 1rem; }
      }
    }

    // --- ESTRUCTURA DE ENTRADAS (ESTILO BESTIARIO) ---
    .handbook-entry {
      display: flex;
      gap: 2rem;
      margin-bottom: 4rem;
      align-items: center;


      @include breakpoint(mobile) {
        flex-direction: column;
        align-items: center;
      }

      .entry-visual {
        flex: 0 0 150px; // Ancho fijo para la imagen
        .entry-img {
          width: 100%;
          mix-blend-mode: multiply; // Elimina el fondo blanco
          filter: sepia(0.2) contrast(1.1);
          
          &.roots-variant { transform: rotate(-10deg) scaleX(-1); }
          &.garden-variant { transform: scale(1); filter: hue-rotate(10deg) multiply; }
        }
      }

      .entry-text {
        flex: 1;
        .entry-title {
          font-family: $font-vintage;
          font-size: 2.2rem;
          margin: 0 0 1rem 0;
          color: $ink-color;
          line-height: 1;
        }

        p {
          font-family: $font-header; // EB Garamond para cuerpo de texto
          font-size: 1.1rem;
          line-height: 1.5;
          text-align: left;
          margin: 0;
          color: #333;
        }
      }
    }

    .title-block {
      text-align: center;
      margin-bottom: 5rem;
      .chapter-title {
        font-family: $font-vintage;
        font-size: 4rem;
        margin: 0;
      }
      .literary-quote {
        font-family: $font-body;
        font-style: italic;
        opacity: 0.7;
      }
    }
  }
}

// src/sass/pages/_chapter2.scss

.migration-overlay {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  pointer-events: none; // Evita interferir con la lectura
  z-index: 5;
  overflow: hidden; // Evita el scroll horizontal
}

.butterfly-ink {
  position: absolute;
  width: 45px;
  height: 45px;
  background-size: contain;
  background-repeat: no-repeat;
  mix-blend-mode: multiply; // Fusión de tinta con el papel
  opacity: 0.75;

  will-change: transform, left, top;

  // --- CORRECCIÓN DE ORIENTACIÓN ---
  // Ajusta el ángulo (90deg, -90deg o 180deg) según la cabeza de tu imagen
  // para que mire hacia la derecha (dirección del vuelo)
  transform: rotate(90deg); 
  
  animation: 
    migration-flight linear forwards, 
    flap-3-frames 0.3s infinite ease-in-out;
}

// ANIMACIÓN DE 3 FOTOGRAMAS
@keyframes flap-3-frames {
  0%, 100% { 
    background-image: url('../../img/mariposa-abierta-new.png'); 
  }
  25%, 75% { 
    background-image: url('../../img/mariposa-media.png'); 
  }
  50% { 
    background-image: url('../../img/mariposa-cerrada-new.png'); 
  }
}

// TRAYECTORIA DE MIGRACIÓN (Izquierda a Derecha)
@keyframes migration-flight {
  0% {
    left: -10%;
    top: var(--y-pos);
  }
  // Añadimos un pequeño vaivén vertical para que no sea una línea recta rígida
  25% { margin-top: -15px; }
  50% { margin-top: 15px; }
  75% { margin-top: -10px; }
  100% {
    left: 110%;
    top: var(--y-pos);
  }
}
.butterfly-overlay {
  position: fixed;
  inset: 0;
  pointer-events: none; // No interfiere con la lectura
  z-index: 10;
  overflow: hidden;
}

.butterfly-ink {
  position: absolute;
  width: 45px;
  height: 45px;
  background-size: contain;
  background-repeat: no-repeat;
  mix-blend-mode: multiply; // Integra el dibujo con el papel
  opacity: 0.8;
  transform: rotate(90deg); 
  transform-origin: center center;
  
  // Animación de vuelo (lenta) y aleteo (rápida)
  animation: 
    butterfly-path linear forwards, 
    butterfly-flap-cycle 0.4s infinite ease-in-out;
}

// ANIMACIÓN DE 4 FRAMES (Ciclo completo de alas)
@keyframes butterfly-flap-cycle {
  0%, 100% { 
    background-image: url('../../img/mariposa-cerrada-new.png'); 
    transform: scale(1);
  }
  25%, 75% { 
    background-image: url('../../img/mariposa-media.png'); 
  }
  50% { 
    background-image: url('../../img/mariposa-cerrada-new.png'); 
    transform: scale(0.9) translateY(-2px); // Simula el impulso hacia arriba
  }
}

// TRAYECTORIA DE VUELO ERRÁTICA
@keyframes butterfly-path {
  0% {
    left: -10%;
    top: var(--y-start);
  }
  30% { transform: translateY(-40px) rotate(-5deg); }
  60% { transform: translateY(30px) rotate(5deg); }
  100% {
    left: 110%;
    top: var(--y-start);
  }
}